<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>expl3 errors</title>
  <link rel="stylesheet" href="node_modules/datatables.net-dt/css/dataTables.dataTables.min.css">
  <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
</head>

<body>
  <div class="container">
    <h1>expl3 warnings and errors</h1>

    <table id="errorTable">
      <thead>
        <tr>
          <th>Filename</th>
          <th># Errors</th>
          <th># Warnings</th>
          <th># Style Warnings</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script src="node_modules/jquery/dist/jquery.min.js"></script>
  <script src="node_modules/datatables.net/js/dataTables.min.js"></script>

  <script>
    $(document).ready(function () {
      $('#errorTable').DataTable({
        stateSave: true,
        ajax: {
          url: 'errors-summarized.json',
          dataSrc: '' // Data is a direct array at the root of the JSON
        },
        columns: [
          { data: 'filename', title: 'Filename' },
          { data: 'errors', title: '# Errors' },
          { data: 'warnings', title: '# Warnings' },
          { data: 'style', title: '# Style Warnings' }
        ],
        columnDefs: [
          {
            targets: 0, // Make filename clickable
            render: function (data, type, row) {
              if (type === 'display') {
                return `<a href="${data}" target="_blank">${data}</a>`;
              }
              return data;
            }
          }
        ],
        createdRow: function (row, data, dataIndex) {
          // Store 'lines' in a hidden attribute for custom search
          $(row).attr('data-lines', data.lines.join(' '));
        }
      })

      // Extend search to include 'lines'
      $.fn.dataTable.ext.search.push(function (settings, searchData, dataIndex) {
        const searchValue = $('#example_filter input').val().toLowerCase();
        const rowLines = $($('#example tbody tr')[dataIndex]).attr('data-lines').toLowerCase();
        return rowLines.includes(searchValue) || searchData.join(' ').toLowerCase().includes(searchValue);
      });

      // Redraw the table when search input changes
      $('#example_filter input').on('input', function () {
        table.draw();
      });
    });
  </script>
</body>

</html>
