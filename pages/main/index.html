<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>expl3 errors</title>
  <link rel="stylesheet" href="node_modules/datatables.net-dt/css/dataTables.dataTables.min.css">
  <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
</head>

<body>
  <div class="container">
    <h1>expl3 errors</h1>

    <div class="row mb-3">
      <label for="totalErrorFiles" class="col-sm-2 col-form-label">Erratic files</label>
      <div class="col-sm-10">
        <div class="form-control" id="totalErrorFiles"></div>
      </div>
    </div>

    <table id="errorTable">
      <thead>
        <tr>
          <th>Filename</th>
          <th>Type</th>
          <th>Line Number</th>
          <th>Column</th>
          <th>End Line Number</th>
          <th>End Column</th>
          <th>Message</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script src="node_modules/jquery/dist/jquery.min.js"></script>
  <script src="node_modules/datatables.net/js/dataTables.min.js"></script>

  <script>
    $(document).ready(function () {
      fetch('errors.json')
        .then(response => response.json())
        .then(data => {
          const uniqueFilenames = new Set();
          data.forEach(entry => {
            if (entry.filename) {
              uniqueFilenames.add(entry.filename);
            }
          });

          document.getElementById('totalErrorFiles').innerHTML = uniqueFilenames.size;

          $('#errorTable').DataTable({
            stateSave: true,
            data: data,
            columns: [
              {
                data: 'filename',
                render: function (data, type, row) {
                  return '<a href="' + data + '">' + data + '</a>';
                }
              },
              {
                data: 'type',
                render: function (data) {
                  if (data === 101) {
                    return "error";
                  } else if (data === 119) {
                    return "warning";
                  } else {
                    return "unknown";
                  }
                }
              },
              { data: 'lnum' },
              { data: 'col' },
              { data: 'end_lnum' },
              { data: 'end_col' },
              { data: 'text' }
            ]
          });
        })
        .catch(error => console.error('Error loading JSON:', error));
    });
  </script>
</body>

</html>
